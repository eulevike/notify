name: API - Remove Ticker

on:
  workflow_dispatch:
    inputs:
      ticker:
        description: 'Ticker symbol to remove (e.g., AAPL)'
        required: true
        type: string

jobs:
  remove-ticker:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Remove ticker
        run: |
          TICKER=$(echo "${{ inputs.ticker }}" | tr '[:lower:]' '[:upper:]')

          # Check if ticker exists
          if ! grep -q "^${TICKER}$" tickers.txt 2>/dev/null; then
            echo "Ticker ${TICKER} not found in watchlist"
            exit 1
          fi

          # Remove ticker from file
          sed -i "/^${TICKER}$/d" tickers.txt
          echo "Removed ${TICKER} from watchlist"

      - name: Commit changes
        run: |
          git config user.name "GitHub Actions"
          git config user.email "actions@github.com"
          git add tickers.txt
          git commit -m "Remove ticker ${{ inputs.ticker }} via API"
          git push
